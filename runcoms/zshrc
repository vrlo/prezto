#
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Customize to your needs...

# disable xon/xoff flow control
stty -ixon

test -e "${HOME}/.iterm2_shell_integration.zsh" && source "${HOME}/.iterm2_shell_integration.zsh"

function iterm2_print_user_vars() {
  iterm2_set_user_var kubecontext "$(if type kubectl >/dev/null; then kubectl config current-context; fi)"
  iterm2_set_user_var kubenamespace "$(if type kubectl >/dev/null; then kubectl config view --minify --output 'jsonpath={..namespace}'; fi)"
}

alias mmv='noglob zmv -W'
test -e /usr/local/share/zsh/site-functions/aws_zsh_completer.sh && source /usr/local/share/zsh/site-functions/aws_zsh_completer.sh

# pyenv
#eval "$(pyenv init -)"
#eval "$(pyenv virtualenv-init -)"

# program yubikey slot 1 with password from clipboard
function pby {
  local slot=1
  if type ykman >/dev/null; then
    ykman otp static --keyboard-layout US --no-enter $slot -- "$(pbpaste)"
  fi
}
# ssh-copy-id-sekey
alias ssh-copy-id-sekey='SSH_AUTH_SOCK=$HOME/.sekey/ssh-agent.ssh ssh-copy-id'
# sekey export to clipboard
alias sekeycopy='SSH_AUTH_SOCK=$HOME/.sekey/ssh-agent.ssh ssh-add -L | pbcopy'

# terraform aliases
alias tf=terraform
alias tfi='terraform init'
alias tfp='terraform plan'
alias tfa='terraform apply'
alias tfw='terraform workspace'

# k8s
K8S_OUTPUT_FORMAT='wide'
alias k=kubectl
alias ka='kubectl apply'
alias kc='kubectl config'
alias kcuc='kubectl config use-context'
alias kcsc='kubectl config set-context'
alias kcdc='kubectl config delete-context'
alias kccc='kubectl config current-context'
alias kcgc='kubectl config get-contexts'
alias kaf='kubectl apply -f'
alias keti='kubectl exec -ti'
alias kg="kubectl get -o $K8S_OUTPUT_FORMAT"
alias kgn='kg no'
alias kgno=kgn
alias kgs='kg svc'
alias kgsw='kgs --watch'
alias kgp='kg po'
alias kgpo=kgp
alias kgpw='kgp --watch'
alias kgd='kg deploy'
alias kgsec='kubectl get secret'
alias kgds='kubectl get daemonset'
alias kgdsw='kgds --watch'
alias kgss='kubectl get statefulset'
alias kgssw='kgss --watch'
alias kgsa='kg -A svc'
alias kgpa='kg -A po'
alias kgda='kg -A deploy'
alias kga='kg all'
alias kgaa='kg all -A'
alias kd='kubectl describe'
alias kds='kd svc'
alias kdp='kd pod'
alias kdd='kd deploy'
alias kdsec='kd secret'
alias kdss='kd statefulset'
alias kdel='k delete'
alias kl='kubectl logs'
alias klf='kubectl logs -f'
alias krun='kubectl run --generator=run-pod/v1 -it --rm=true --restart=Never'
alias kctx='kubectx'
alias kns='kubens'
alias ktn='k top no --use-protocol-buffers'
alias ktp='k top po --use-protocol-buffers'


autoload -U +X bashcompinit && bashcompinit
complete -o nospace -C /usr/local/bin/vault vault

# az cli completion
. /opt/homebrew/Cellar/azure-cli/*/etc/bash_completion.d/az

# tabtab source for serverless package
# uninstall by removing these lines or running `tabtab uninstall serverless`
[[ -f /usr/local/lib/node_modules/serverless/node_modules/tabtab/.completions/serverless.zsh ]] && . /usr/local/lib/node_modules/serverless/node_modules/tabtab/.completions/serverless.zsh
# tabtab source for sls package
# uninstall by removing these lines or running `tabtab uninstall sls`
[[ -f /usr/local/lib/node_modules/serverless/node_modules/tabtab/.completions/sls.zsh ]] && . /usr/local/lib/node_modules/serverless/node_modules/tabtab/.completions/sls.zsh
# tabtab source for slss package
# uninstall by removing these lines or running `tabtab uninstall slss`
[[ -f /usr/local/lib/node_modules/serverless/node_modules/tabtab/.completions/slss.zsh ]] && . /usr/local/lib/node_modules/serverless/node_modules/tabtab/.completions/slss.zsh

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# Created by `userpath` on 2020-06-15 17:14:46
PATH="$PATH:/Users/lseder/.local/bin"
PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"
PATH="/usr/local/opt/gnu-getopt/bin:$PATH"
export PATH

# nvm
export NVM_DIR="$HOME/.nvm"
[ -s "/usr/local/opt/nvm/nvm.sh" ] && . "/usr/local/opt/nvm/nvm.sh"  # This loads nvm
[ -s "/usr/local/opt/nvm/etc/bash_completion.d/nvm" ] && . "/usr/local/opt/nvm/etc/bash_completion.d/nvm"  # This loads nvm bash_completion
